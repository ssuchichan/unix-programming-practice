# TCP
服务器为多个客户端提供服务。

## 多进程（PPC，Process Per Connection），多线程（TPC，Thread Per Connection）
* 优点：为客户端提供一对一的服务，及时处理客户端各种请求。
* 缺点：增加了服务器的负荷和开销，浪费资源，实际开发中较少采用。


## select
非阻塞系统调用，用单个线程为多个客户端提供服务。通过select监控多个客户端套接字，选择处理其中“活跃”的连接，服务器通过高速处理方式可以为多个
客户端提供服务，不需开多个线程。
* 优点：降低了服务器负荷，提高了资源利用率
* 缺点：
  * 处理的连接数有限，最多1024个连接
  * 处理的速度比较慢，数据在内核和用户空间拷贝
  * select之后需要对所有套接字遍历，费时
* 编程模型
  * 预先接受用户连接请求，记录多个客户端的套接字 
  * 用select监听多个通信套接字 
  * 判断找出活跃连接，对其进行处理

## epoll
select的增强版，服务端采用单个线程为多个客户端提供服务。对多个客户端的连接进行监控，处理“活跃”的连接，可直接处理，可同时监控套接字和多个通信连接。
* 优点：可以监听和处理百万级的连接，相比select系统调用，epoll返回的是活跃的连接，不需要遍历，提高了效率。
* 缺点：没有提供一对一服务，一对多服务，处理每次请求时间较长，会使得其他请求得不到及时处理。
* 编程模型
  ```
  #include <sys/epoll.h>
  
  // 创建epoll实例，size要大于0
  int epoll_create(int size);
  
  int epoll_create1(int flags);
  
  int epoll_ctl(
      int                  epfd, 
      int                  op, 
      int                  fd, 
      struct epoll_event*  event
  );
  
  int epoll_wait(
      int                  epfd, 
      struct epoll_event*  events, 
      int                  maxevents, 
      int                  timeout
  );
  ```
  * 创建epollfd：`epoll_create1`
  * 向epollfd添加要监控的套接字：`epoll_ctl`
  * 监控套接字：`epoll_wait`
  * 处理活跃的套接字

## 线程池技术
* 服务器根据相关分析预先产生一批线程，放入线程池中，所有线程均处于阻塞状态。
* 有新连接到来时，用线程池中的一个线程为其服务，客户端连接中断后，线程并不销毁，回到线程池中阻塞。
* 如果连接数量较少，会造成资源浪费；如果连接过多，则处理多个连接的能力会变弱。因此要根据连接数量及时调整线程池中线程数量，减少资源浪费，提高并发处理能力。




