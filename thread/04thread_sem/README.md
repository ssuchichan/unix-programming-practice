# 线程之间同步机制

* 互斥：控制线程对共享资源互斥访问
* 同步：线程间协同步调

## 线程同步概念

引例：线程A从键盘接收数据存入共享区，线程B从共享区读取数据并显示在屏幕上

* 产生两个线程
* 全局变量是线程之间的共享资源

```
int g_data;
sem1 = 1 // 写信号量
sem2 = 0 // 读信号量

线程A:
while(1) {
	阻塞等待B取数据  sem1 = sem1 - 1
	scanf("%d", &g_data);
	通知线程B获取数据 sem2 = sem2 + 1
}

线程B:
while(1) {
	阻塞等待A写入数据 sem2 = sem2 - 1
	printf("%d\n", g_data);
	通知线程A可以写入数据 sem1 = sem1 + 1
}
```

## 信号量概念和使用方法

信号量是线程同步和互斥的一种机制。

信号量就是一个整数：

* 访问共享资源前减1，如果小于0，则阻塞当前线程，否则线程继续运行
* 访问共享资源后加1，如果大于0，唤醒阻塞在该信号量上的所有线程

## 线程同步编程

* 定义信号量`sem_t`
* 初始化信号量`sem_init`
* 使用信号量`sem_wait/sem_post`
* 销毁信号量`sem_destroy`


